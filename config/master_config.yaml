# ==================================================================
# XAUUSD MT5 TRADING SYSTEM - MASTER CONFIG
# ==========================================
# Version: 1.0.0
# Date: 2025-01-07
# 
# This is the master configuration file for the entire trading system.
# Modify these settings to customize the bot's behavior.
# 
# IMPORTANT: Back up this file before making changes!
# ==========================================
# ==========================================
# MT5 CONNECTION SETTINGS
# ==========================================
mt5:
  # Your MT5 account credentials
  login: 12345678                    # Your MT5 account number
  password: "your_password_here"     # Your MT5 password
  server: "YourBroker-Server"        # Your broker's server name
  terminal_path: null                # Path to terminal64.exe (optional, auto-detect if null)
  
  # Connection settings
  timeout: 60000                     # Connection timeout in milliseconds
  retry_count: 3                     # Number of connection retry attempts
  retry_delay: 5                     # Delay between retries in seconds
  
  # Trading settings
  magic_number: 123456               # Unique identifier for this EA's trades
  slippage: 20                       # Maximum slippage in points
  deviation: 10                      # Maximum price deviation

# ==========================================
# TRADING PARAMETERS
# ==========================================
trading:
  # Primary trading symbol
  symbol: "XAUUSDm"                  # Gold vs USD (Exness MT5 symbol)
  
  # Alternative symbols for data correlation
  alternative_symbols:
    - "GOLD"                        # Alternative gold symbol
    - "GLD"                         # Gold ETF for correlation
  
  # Capital management
  capital:
    initial_capital: 100.00         # Starting capital in USD
    target_capital: 1000.00         # Target capital (10x in 30 days)
    minimum_capital: 50.00          # Stop trading below this level
    reserve_cash: 0.10              # Keep 10% in reserve (less aggressive than before)
  
  # Risk management (Aggressive for 10x target)
  risk_management:
    risk_per_trade: 0.03            # 3% risk per trade (aggressive)
    max_risk_per_trade: 0.05        # Maximum 5% in high-confidence signals
    max_portfolio_risk: 0.15        # 15% maximum portfolio risk at any time
    max_drawdown: 0.25              # 25% maximum drawdown before stopping
    max_daily_loss: 0.10            # 10% daily loss limit
    max_weekly_loss: 0.20           # 20% weekly loss limit
    max_consecutive_losses: 4        # Stop after 4 consecutive losses
    
  # Position sizing
  position_sizing:
    method: "kelly_modified"         # Options: fixed, kelly, kelly_modified, volatility_based
    kelly_safety_factor: 0.30       # Use 30% of Kelly suggestion
    min_position_size: 0.01         # Minimum position in lots
    max_position_size: 0.10         # Maximum position in lots
    max_positions: 3                # Maximum concurrent positions
    
  # Trade management
  trade_management:
    stop_loss_method: "atr"         # Options: fixed, atr, support_resistance, trailing
    stop_loss_atr_multiplier: 1.5   # ATR multiplier for stop loss
    stop_loss_min_pips: 30          # Minimum stop loss in pips
    stop_loss_max_pips: 100         # Maximum stop loss in pips
    
    take_profit_method: "rr_ratio"  # Options: fixed, rr_ratio, resistance, trailing
    risk_reward_ratio: 2.0           # Minimum R:R ratio
    
    trailing_stop_enabled: true     # Enable trailing stop
    trailing_stop_trigger: 50       # Pips in profit before trailing starts
    trailing_stop_distance: 30      # Trailing stop distance in pips
    
    partial_close_enabled: true     # Enable partial position closing
    partial_close_levels:           # Close portions at profit levels
      - {pips: 30, percent: 0.33}   # Close 33% at 30 pips
      - {pips: 50, percent: 0.50}   # Close 50% of remainder at 50 pips
    
    breakeven_enabled: true         # Move stop to breakeven
    breakeven_trigger: 25           # Pips in profit before breakeven
    breakeven_buffer: 5             # Pips above entry for breakeven

# Partial exit configuration
partial_exits:
  profit_thresholds: [2.0, 4.0, 3.0]
  close_percentages: [0.25, 0.25]
  min_position_size: 0.02

# ==========================================
# STRATEGY SELECTION
# ==========================================
strategies:
  # Master strategy selector
  # Set enabled: true for strategies you want to use
  # Adjust weights to control influence in signal fusion
  
  # Technical Analysis Strategies
  technical:
    enabled: true                    # Enable technical strategies
    weight: 0.40                    # 40% weight in signal fusion
    
    # Individual technical strategies (enable/disable each)
    active_strategies:
      ichimoku: true                # Ichimoku Cloud System
      harmonic: true                # Harmonic Pattern Recognition
      elliott_wave: true           # Elliott Wave Analysis (complex, disabled by default)
      volume_profile: true          # Volume Profile Analysis
      market_profile: true         # Market Profile (requires tick data)
      order_flow: true              # Order Flow Imbalance
      wyckoff: true                 # Wyckoff Method
      gann: true                   # Gann Analysis (complex)
      fibonacci_advanced: true      # Advanced Fibonacci Clusters
      momentum_divergence: true     # Multi-timeframe Momentum Divergence
    
    # Technical strategy parameters
    parameters:
      confidence_threshold: 0.65    # Minimum confidence for signal
      timeframe_primary: "M15"      # Primary analysis timeframe
      timeframe_secondary: "H1"     # Secondary confirmation timeframe
      lookback_period: 200          # Bars to analyze
  
  # Smart Money Concepts (SMC)
  smc:
    enabled: true                   # Enable SMC strategies
    weight: 0.35                    # 35% weight in signal fusion
    
    # SMC components
    active_components:
      market_structure: true        # Market structure analysis
      order_blocks: true            # Order block detection
      fair_value_gaps: false         # FVG identification
      liquidity_pools: true         # Liquidity pool detection
      manipulation: true            # Session manipulation detection
    
    # SMC parameters
    parameters:
      confidence_threshold: 0.70    # Higher threshold for SMC
      swing_length: 10              # Swing detection sensitivity
      order_block_min_strength: 2.0 # Minimum OB strength
      fvg_min_size: 0.5            # Minimum FVG size in ATR
      liquidity_sweep_tolerance: 1.2 # Sweep tolerance in ATR
    
    # Timeframes for multi-timeframe analysis
    timeframes:
      structure: "H4"               # Major structure
      intermediate: "H1"            # Intermediate structure
      entry: "M15"                  # Entry timeframe
      execution: "M5"               # Execution timeframe
  
  # Machine Learning Strategies
  ml:
    enabled: true                   # Enable ML strategies
    weight: 0.25                    # 25% weight in signal fusion
    
    # Active ML models
    active_models:
      lstm_predictor: true          # LSTM price prediction
      xgboost_classifier: true      # XGBoost classification
      rl_agent: true               # RL agent (requires training)
      ensemble_nn: true             # Ensemble neural network
    
    # ML parameters
    parameters:
      confidence_threshold: 0.60    # Reduced for more signals
      prediction_horizon: 12        # Bars ahead to predict
      feature_lookback: 50          # Historical bars for features
      retrain_frequency: "weekly"   # Model retraining frequency
      min_training_samples: 1000    # Minimum samples for training
    
    # Feature engineering
    features:
      price_features: true          # OHLC-based features
      technical_features: true      # Technical indicators
      volume_features: true         # Volume analysis
      time_features: true           # Time-based features
      market_features: true         # Market microstructure
  
  # Signal Fusion Strategy
  fusion:
    enabled: true                   # Use fusion (recommended)
    method: "weighted_voting"       # Options: weighted_voting, ml_fusion, adaptive
    
    # Active fusion strategies
    active_strategies:
      adaptive_ensemble: true       # Adaptive ensemble fusion
      weighted_voting: true         # Weighted voting fusion
      confidence_sizing: true       # Confidence-based position sizing
      regime_detection: true        # Market regime detection
    
    # Fusion parameters
    parameters:
      min_strategies_agreement: 2   # Minimum strategies agreeing
      confidence_threshold: 0.55    # Reduced for more signals
      
      # Signal quality filters
      quality_filters:
        min_signal_strength: 0.65   # Minimum signal strength
        max_signals_per_day: 20     # Maximum daily signals
        min_time_between_signals: 15 # Minutes between signals
        
      # Market condition filters
      market_filters:
        volatility_filter: true     # Filter by volatility
        session_filter: true        # Filter by trading session
        trend_filter: true          # Filter by trend strength
        volume_filter: true         # Filter by volume
    
    # Adaptive fusion settings
    adaptive:
      enabled: true                 # Enable adaptive weight adjustment
      lookback_period: 100          # Trades to consider for adaptation
      performance_metric: "sharpe"  # Metric for performance evaluation
      adjustment_rate: 0.1          # Weight adjustment rate

# ==========================================
# TIMEFRAME SETTINGS
# ==========================================
timeframes:
  # Data collection timeframes
  data:
    primary: "M15"                  # Primary trading timeframe
    secondary: ["M5", "H1"]         # Supporting timeframes
    analysis: ["M1", "M5", "M15", "M30", "H1", "H4", "D1"]  # All analysis timeframes
  
  # Timeframe-specific settings
  settings:
    M1:
      enabled: false                # Too noisy for gold
      max_spread: 5                 # Maximum spread in points
    M5:
      enabled: true
      max_spread: 8
    M15:
      enabled: true                 # Primary timeframe
      max_spread: 10
    M30:
      enabled: true
      max_spread: 12
    H1:
      enabled: true
      max_spread: 15
    H4:
      enabled: true
      max_spread: 20
    D1:
      enabled: false                # Too slow for aggressive targets
      max_spread: 30

# ==========================================
# MARKET SESSIONS
# ==========================================
sessions:
  # Trading session times (in MT5 server time)
  asian:
    start: "00:00"
    end: "09:00"
    enabled: true
    volatility: "low"
    strategy_preference: ["range", "smc"]
    max_positions: 1
    risk_multiplier: 0.8            # Reduce risk in low volatility
  
  london:
    start: "09:00"
    end: "17:00"
    enabled: true
    volatility: "high"
    strategy_preference: ["breakout", "momentum", "smc"]
    max_positions: 2
    risk_multiplier: 1.2            # Increase risk in high volatility
  
  newyork:
    start: "14:00"
    end: "23:00"
    enabled: true
    volatility: "high"
    strategy_preference: ["momentum", "technical"]
    max_positions: 2
    risk_multiplier: 1.0
  
  # Overlap sessions (highest volatility)
  london_ny_overlap:
    start: "14:00"
    end: "17:00"
    enabled: true
    volatility: "very_high"
    strategy_preference: ["all"]
    max_positions: 3
    risk_multiplier: 1.5            # Maximum risk during overlap

# ==========================================
# DATA MANAGEMENT
# ==========================================
data:
  # Data source mode: 'mock' uses random OHLCV bars, 'live' streams from MT5
  mode: "mock"                    # Options: mock, live
  # Historical data settings
  history:
    min_bars_required: 500          # Minimum bars for strategy
    max_bars_stored: 10000          # Maximum bars in memory
    update_frequency: 1             # Update every N minutes
    
  # Real-time data settings
  realtime:
    tick_collection: false          # Collect tick data (resource intensive)
    bar_collection: true            # Collect bar data
    spread_monitoring: true         # Monitor spread changes
    
  # Data validation
  validation:
    check_gaps: true                # Check for data gaps
    max_gap_size: 5                 # Maximum gap in bars
    remove_outliers: true           # Remove price outliers
    outlier_threshold: 5            # Standard deviations for outlier
    # Precision validation
    precision_tolerance: 0.000001   # Max fractional drift after rounding by symbol digits

# ==========================================
# SIGNAL GENERATION
# ==========================================
signals:
  # Signal quality grading
  grading:
    A_grade:                        # Highest quality signals
      min_confidence: 0.85
      max_daily: 5
      position_size_multiplier: 1.5
      strategies_required: 3
      
    B_grade:                        # Good quality signals
      min_confidence: 0.70
      max_daily: 8
      position_size_multiplier: 1.0
      strategies_required: 2
      
    C_grade:                        # Acceptable signals
      min_confidence: 0.60
      max_daily: 7
      position_size_multiplier: 0.5
      strategies_required: 1
  
  # Signal filtering
  filters:
    spread_filter:
      enabled: true
      max_spread: 15                # Maximum spread in points
      
    volatility_filter:
      enabled: true
      min_atr: 5                    # Minimum ATR for signal
      max_atr: 50                   # Maximum ATR for signal
      
    time_filter:
      enabled: true
      blocked_hours: [23]           # Don't trade at these hours
      blocked_days: [0, 6]         # Don't trade on Sunday (0) and Saturday (6)
      
    news_filter:
      enabled: true
      high_impact_hours_before: 1   # Hours before high impact news
      high_impact_hours_after: 1    # Hours after high impact news

# ==========================================
# EXECUTION SETTINGS
# ==========================================
execution:
  # Order execution parameters
  order:
    type: "market"                  # Options: market, limit, stop
    retry_attempts: 3               # Retry failed orders
    retry_delay: 1                  # Seconds between retries
    
  # Slippage protection
  slippage:
    max_slippage: 3                 # Maximum slippage in pips
    reject_on_slippage: true        # Reject order if slippage too high
    
  # Latency management
  latency:
    max_latency: 1000               # Maximum acceptable latency in ms
    check_latency: true             # Monitor execution latency
    
  # Order validation
  validation:
    check_margin: true              # Verify sufficient margin
    check_spread: true              # Verify spread acceptable
    check_trading_hours: true       # Verify market open

# ==========================================
# PERFORMANCE MONITORING
# ==========================================
monitoring:
  # Performance metrics
  metrics:
    calculate_sharpe: true          # Calculate Sharpe ratio
    calculate_sortino: true         # Calculate Sortino ratio
    calculate_calmar: true          # Calculate Calmar ratio
    calculate_max_drawdown: true    # Track maximum drawdown
    
  # Performance thresholds
  thresholds:
    min_win_rate: 0.55              # Minimum acceptable win rate
    min_profit_factor: 1.5          # Minimum profit factor
    max_drawdown: 0.25              # Maximum drawdown before stopping
    
  # Reporting
  reporting:
    daily_report: true              # Generate daily reports
    weekly_report: true             # Generate weekly reports
    trade_log: true                 # Log all trades
    signal_log: true                # Log all signals

# ==========================================
# BACKTESTING SETTINGS
# ==========================================
backtesting:
  # Backtest parameters
  parameters:
    start_date: "2024-01-01"        # Backtest start date
    end_date: "2024-12-31"          # Backtest end date
    initial_balance: 100            # Starting balance
    
  # Execution simulation
  simulation:
    spread_modeling: true           # Model realistic spreads
    slippage_modeling: true         # Model slippage
    commission: 7                   # Commission per lot per side
    swap_rates: true                # Include swap rates
    
  # Validation
  validation:
    walk_forward: true              # Use walk-forward analysis
    out_of_sample_percent: 0.3      # Reserve 30% for out-of-sample
    monte_carlo_runs: 1000          # Number of Monte Carlo simulations
    
  # Optimization
  optimization:
    enabled: true                   # Enable parameter optimization
    method: "genetic"               # Options: grid, random, genetic, bayesian
    metric: "sharpe"                # Optimization target
    max_iterations: 1000            # Maximum optimization iterations

# ==========================================
# RISK CONTROLS
# ==========================================
risk_controls:
  # Emergency stop conditions
  emergency_stop:
    daily_loss_limit: 0.15          # Stop if daily loss exceeds 15%
    weekly_loss_limit: 0.25         # Stop if weekly loss exceeds 25%
    consecutive_losses: 5           # Stop after 5 consecutive losses
    
  # Position limits
  position_limits:
    max_positions: 3                # Maximum concurrent positions
    max_position_size: 0.10         # Maximum size per position in lots
    max_exposure: 0.20              # Maximum total exposure
    
  # Correlation limits
  correlation:
    check_correlation: true         # Check correlation between positions
    max_correlation: 0.7            # Maximum allowed correlation
    
  # Recovery mode
  recovery_mode:
    enabled: true                   # Enable recovery mode after losses
    trigger_drawdown: 0.10          # Trigger at 10% drawdown
    risk_reduction: 0.5             # Reduce risk by 50% in recovery
    recovery_target: 0.05           # Exit recovery after 5% profit

# ==========================================
# NOTIFICATIONS
# ==========================================
notifications:
  # Email notifications (future implementation)
  email:
    enabled: false
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    sender: "your_email@gmail.com"
    password: "your_app_password"
    recipients: ["alert@example.com"]
    
    # Email triggers
    send_on:
      new_trade: true
      trade_closed: true
      daily_report: true
      emergency_stop: true
      high_drawdown: true
  
  # Telegram notifications (future implementation)
  telegram:
    enabled: false
    bot_token: "your_bot_token"
    chat_id: "your_chat_id"
    
    # Telegram triggers
    send_on:
      new_signal: false             # Too frequent
      new_trade: true
      trade_closed: true
      daily_summary: true
      emergency: true
  
  # Dashboard notifications
  dashboard:
    enabled: true
    update_frequency: 5             # Update every N seconds
    show_alerts: true
    alert_duration: 10              # Show alerts for N seconds

# ==========================================
# LOGGING SETTINGS
# ==========================================
logging:
  # Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"
  
  # Log files
  files:
    system_log: "logs/system.log"
    trade_log: "logs/trades.log"
    signal_log: "logs/signals.log"
    error_log: "logs/errors.log"
    performance_log: "logs/performance.log"
  
  # Log rotation
  rotation:
    enabled: true
    max_size: "10MB"               # Rotate when file reaches size
    backup_count: 10               # Keep N backup files
    
  # Console output
  console:
    enabled: true
    colored: true                  # Use colored output
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# ==========================================
# DATABASE SETTINGS
# ==========================================
database:
  # Database configuration
  type: "sqlite"                   # Options: sqlite, postgresql, mysql
  
  # SQLite settings
  sqlite:
    path: "data/trading.db"
    
  # PostgreSQL settings (future)
  postgresql:
    host: "localhost"
    port: 5432
    database: "trading_db"
    user: "trader"
    password: "password"
  
  # Data retention
  retention:
    trades: 365                    # Keep trades for N days
    signals: 90                    # Keep signals for N days
    ticks: 7                       # Keep tick data for N days
    performance: 365               # Keep performance data for N days

# ==========================================
# DASHBOARD SETTINGS
# ==========================================
dashboard:
  # Streamlit configuration
  streamlit:
    port: 8501
    theme: "dark"                  # Options: light, dark
    auto_refresh: true
    refresh_interval: 5            # Seconds
    
  # Dashboard components
  components:
    account_info: true
    open_positions: true
    trade_history: true
    performance_chart: true
    signal_monitor: true
    risk_metrics: true
    strategy_performance: true
    market_analysis: true
    
  # Chart settings
  charts:
    candlestick: true
    indicators: true
    trade_markers: true
    signal_markers: true
    
  # Performance metrics display
  metrics:
    daily_pnl: true
    win_rate: true
    profit_factor: true
    sharpe_ratio: true
    drawdown: true
    roi: true

# ==========================================
# SYSTEM SETTINGS
# ==========================================
system:
  # Performance settings
  performance:
    multiprocessing: true          # Use multiple CPU cores
    max_workers: 4                 # Maximum worker threads
    
  # Memory management
  memory:
    max_memory_usage: 0.8          # Maximum RAM usage (80%)
    garbage_collection: true       # Enable garbage collection
    gc_interval: 3600              # GC interval in seconds
    
  # Error handling
  error_handling:
    restart_on_error: true         # Restart system on critical error
    max_restart_attempts: 3        # Maximum restart attempts
    error_notification: true       # Send notification on error
    
  # Maintenance
  maintenance:
    auto_cleanup: true             # Clean old files automatically
    cleanup_interval: 86400        # Daily cleanup (seconds)
    backup_config: true            # Backup configuration daily
    backup_database: true          # Backup database daily

# ==========================================
# END OF CONFIGURATION
# ==========================================